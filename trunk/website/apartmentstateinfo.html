<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List href="apartmentstateinfo_bestanden/filelist.xml">
<link rel=Edit-Time-Data href="apartmentstateinfo_bestanden/editdata.mso">
<!--[if !mso]>
<style>
v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
</style>
<![endif]-->
<title>WatiN</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>J.vanMenen</o:Author>
  <o:LastAuthor>J.vanMenen</o:LastAuthor>
  <o:Revision>35</o:Revision>
  <o:TotalTime>216</o:TotalTime>
  <o:Created>2006-07-11T11:06:00Z</o:Created>
  <o:LastSaved>2006-09-27T08:51:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>1272</o:Words>
  <o:Characters>6999</o:Characters>
  <o:Lines>58</o:Lines>
  <o:Paragraphs>16</o:Paragraphs>
  <o:CharactersWithSpaces>8255</o:CharactersWithSpaces>
  <o:Version>11.8036</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:HyphenationZone>21</w:HyphenationZone>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:1627421319 -2147483648 8 0 66047 0;}
@font-face
	{font-family:Verdana;
	panose-1:2 11 6 4 3 5 4 4 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:536871559 0 0 0 415 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;
	text-underline:single;}
p
	{margin-top:4.5pt;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
pre
	{margin-top:3.75pt;
	margin-right:3.75pt;
	margin-bottom:3.75pt;
	margin-left:11.25pt;
	mso-pagination:widow-orphan;
	tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
	font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";}
p.cl, li.cl, div.cl
	{mso-style-name:cl;
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
span.cb11
	{mso-style-name:cb11;
	color:blue;}
span.code-keyword2
	{mso-style-name:code-keyword2;
	color:#000091;}
@page Section1
	{size:595.3pt 841.9pt;
	margin:70.85pt 70.85pt 70.85pt 70.85pt;
	mso-header-margin:35.4pt;
	mso-footer-margin:35.4pt;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 @list l0
	{mso-list-id:449973970;
	mso-list-type:hybrid;
	mso-list-template-ids:-1487622478 68354049 68354051 68354053 68354049 68354051 68354053 68354049 68354051 68354053;}
@list l0:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:18.0pt;
	mso-level-number-position:left;
	margin-left:18.0pt;
	text-indent:-18.0pt;
	font-family:Symbol;}
@list l0:level2
	{mso-level-tab-stop:72.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l0:level3
	{mso-level-tab-stop:108.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l0:level4
	{mso-level-tab-stop:144.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l0:level5
	{mso-level-tab-stop:180.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l0:level6
	{mso-level-tab-stop:216.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l0:level7
	{mso-level-tab-stop:252.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l0:level8
	{mso-level-tab-stop:288.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l0:level9
	{mso-level-tab-stop:324.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l1
	{mso-list-id:1676373268;
	mso-list-template-ids:-743778964;}
@list l2
	{mso-list-id:2100825687;
	mso-list-type:hybrid;
	mso-list-template-ids:-1652123634 68354063 68354073 68354075 68354063 68354073 68354075 68354063 68354073 68354075;}
@list l2:level1
	{mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l2:level2
	{mso-level-tab-stop:72.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l2:level3
	{mso-level-tab-stop:108.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l2:level4
	{mso-level-tab-stop:144.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l2:level5
	{mso-level-tab-stop:180.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l2:level6
	{mso-level-tab-stop:216.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l2:level7
	{mso-level-tab-stop:252.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l2:level8
	{mso-level-tab-stop:288.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l2:level9
	{mso-level-tab-stop:324.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:Standaardtabel;
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
table.MsoTableGrid
	{mso-style-name:Tabelraster;
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	border:solid windowtext 1.0pt;
	mso-border-alt:solid windowtext .5pt;
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-border-insideh:.5pt solid windowtext;
	mso-border-insidev:.5pt solid windowtext;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="20482">
  <o:colormenu v:ext="edit" fillcolor="silver"/>
 </o:shapedefaults></xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body lang=NL link=blue vlink=purple style='tab-interval:35.4pt'>

<div class=Section1>

<p class=MsoNormal align=center style='text-align:center'><b><i
style='mso-bidi-font-style:normal'><span lang=EN-GB style='font-size:36.0pt;
font-family:Tahoma;color:#99CC00;mso-ansi-language:EN-GB'>W</span></i></b><b><span
lang=EN-GB style='font-size:36.0pt;font-family:Tahoma;color:#99CC00;mso-ansi-language:
EN-GB'>ati<i style='mso-bidi-font-style:normal'>N</i></span></b><b><span
lang=EN-GB style='font-size:36.0pt;font-family:Arial;color:lime;mso-ansi-language:
EN-GB'><span style='mso-tab-count:1'>   </span></span></b><i><span lang=EN-GB
style='font-size:20.0pt;font-family:Tahoma;color:#FFCC00;mso-ansi-language:
EN-GB'>Web Application Testing in .Net<o:p></o:p></span></i></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:20.0pt;font-family:Arial;
color:#FFCC00;mso-ansi-language:EN-GB'><o:p>&nbsp;</o:p></span></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0 width="100%"
 style='width:100.02%;border-collapse:collapse;border:none;mso-border-alt:solid windowtext .5pt;
 mso-padding-alt:0cm 0cm 0cm 0cm;mso-border-insideh:.5pt solid windowtext;
 mso-border-insidev:.5pt solid windowtext'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;height:17.0pt'>
  <td width="100%" colspan=8 valign=top style='width:100.0%;border:solid windowtext 1.0pt;
  mso-border-alt:solid windowtext .5pt;background:#99CC00;padding:0cm 5.4pt 0cm 5.4pt;
  height:17.0pt'>
  <p class=MsoNormal style='background:#99CC00'><b style='mso-bidi-font-weight:
  normal'><span lang=EN-GB style='font-size:14.0pt;font-family:Tahoma;
  color:white;mso-ansi-language:EN-GB'>Documentation </span></b><span
  lang=EN-GB style='font-size:10.0pt;font-family:Tahoma;color:white;mso-ansi-language:
  EN-GB'>&gt;&gt;</span><b style='mso-bidi-font-weight:normal'><span
  lang=EN-GB style='font-size:14.0pt;font-family:Tahoma;color:white;mso-ansi-language:
  EN-GB'> WatiN and Thread.Apartmentstate</span></b><b style='mso-bidi-font-weight:
  normal'><span lang=EN-GB style='font-size:14.0pt;color:white;mso-ansi-language:
  EN-GB'><o:p></o:p></span></b></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;mso-yfti-lastrow:yes;height:17.0pt'>
  <td width="12%" valign=top style='width:12.5%;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 0cm 0cm 0cm;height:17.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-GB
  style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:EN-GB'><a
  href="index.html">Home</a></span><span style='font-size:11.0pt;font-family:
  Tahoma'><o:p></o:p></span></p>
  </td>
  <td width="12%" valign=top style='width:12.5%;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt;height:17.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-GB
  style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:EN-GB'><a
  href="http://sourceforge.net/news/?group_id=167632">News</a></span><span
  style='font-size:11.0pt;font-family:Tahoma'><o:p></o:p></span></p>
  </td>
  <td width="12%" valign=top style='width:12.5%;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 0cm 0cm 0cm;height:17.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-GB
  style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:EN-GB'><a
  href="http://sourceforge.net/project/showfiles.php?group_id=167632">Download</a></span><span
  style='font-size:11.0pt;font-family:Tahoma'><o:p></o:p></span></p>
  </td>
  <td width="12%" valign=top style='width:12.5%;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 0cm 0cm 0cm;height:17.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-GB
  style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:EN-GB'><a
  href="documentatie.html">Documentation</a></span><span style='font-size:11.0pt;
  font-family:Tahoma'><o:p></o:p></span></p>
  </td>
  <td width="12%" valign=top style='width:12.52%;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 0cm 0cm 0cm;height:17.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-GB
  style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:EN-GB'><a
  href="http://sourceforge.net/projects/watin">Project pages</a></span><span
  style='font-size:11.0pt;font-family:Tahoma'><o:p></o:p></span></p>
  </td>
  <td width="12%" valign=top style='width:12.5%;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 0cm 0cm 0cm;height:17.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:EN-US'><a
  href="http://sourceforge.net/mail/?group_id=167632">Mailing lists</a></span><span
  style='font-size:11.0pt;font-family:Tahoma'><o:p></o:p></span></p>
  </td>
  <td width="12%" valign=top style='width:12.5%;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 0cm 0cm 0cm;height:17.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-GB
  style='font-size:11.0pt;font-family:Tahoma;color:black;background:white;
  mso-ansi-language:EN-GB'><a
  href="http://sourceforge.net/export/rss2_project.php?group_id=167632">RSS
  feeds</a><o:p></o:p></span></p>
  </td>
  <td width="12%" valign=top style='width:12.48%;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 0cm 0cm 0cm;height:17.0pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-GB
  style='font-size:11.0pt;font-family:Tahoma;color:black;background:white;
  mso-ansi-language:EN-GB'><a href="mailto:jvmenen@users.sourceforge.net">Contact</a><o:p></o:p></span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;
mso-ansi-language:EN-GB'>Following is some information about WatiN and the need
to set the Thread.Apartmentstate to STA. If you use a (test) runner which need
some special handling to set the ApartmentState which is not mentioned on this
page, please let me know so I can add it to this page.<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-GB style='font-family:Tahoma;mso-ansi-language:
EN-GB'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-GB
style='font-family:Tahoma;color:#99CC00;mso-ansi-language:EN-GB'>Index<o:p></o:p></span></b></p>

<ol style='margin-top:0cm' start=1 type=1>
 <li class=MsoNormal style='mso-list:l2 level1 lfo3;tab-stops:list 36.0pt'><span
     lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:
     EN-GB'>Why is setting the ApartmentState needed in the first place?<o:p></o:p></span></li>
 <li class=MsoNormal style='mso-list:l2 level1 lfo3;tab-stops:list 36.0pt'><span
     lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:
     EN-GB'>Differences in ApartmentState between .Net 1.1 and .Net 2.0.<o:p></o:p></span></li>
 <li class=MsoNormal style='mso-list:l2 level1 lfo3;tab-stops:list 36.0pt'><span
     lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:
     EN-GB'>Implications.<o:p></o:p></span></li>
 <li class=MsoNormal style='mso-list:l2 level1 lfo3;tab-stops:list 36.0pt'><span
     lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:
     EN-GB'>Behaviour of WatiN when Thread is not an STA Thread.<o:p></o:p></span></li>
 <li class=MsoNormal style='mso-list:l2 level1 lfo3;tab-stops:list 36.0pt'><span
     lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:
     EN-GB'><a href="#mbunit">Using WatiN and MBUnit</a>.<o:p></o:p></span></li>
 <li class=MsoNormal style='mso-list:l2 level1 lfo3;tab-stops:list 36.0pt'><span
     lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:
     EN-GB'><a href="#nunit">Using WatiN and NUnit</a>.<o:p></o:p></span></li>
 <li class=MsoNormal style='mso-list:l2 level1 lfo3;tab-stops:list 36.0pt'><span
     lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:
     EN-GB'><a href="#vs2005">Using WatiN and Visual Studio 2005 test runner</a>.<o:p></o:p></span></li>
 <li class=MsoNormal style='mso-list:l2 level1 lfo3;tab-stops:list 36.0pt'><span
     lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:
     EN-GB'><a href="#testdriven">Using WatiN and TestDriven.Net in VS 2003 and
     VS2005</a>.<o:p></o:p></span></li>
 <li class=MsoNormal style='mso-list:l2 level1 lfo3;tab-stops:list 36.0pt'><span
     lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:
     EN-GB'><a href="#sharpdevelop">Using WatiN and SharpDevelops NUnit test
     runner</a>.<o:p></o:p></span></li>
</ol>

<p class=MsoNormal><span lang=EN-GB style='font-family:Tahoma;mso-ansi-language:
EN-GB'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-GB
style='font-family:Tahoma;color:#99CC00;mso-ansi-language:EN-GB'>Why is setting
the ApartmentState needed in the first place?<o:p></o:p></span></b></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;
mso-ansi-language:EN-GB'>Copied from MSDN (</span><span class=MsoHyperlink><span
lang=EN-GB style='mso-ansi-language:EN-GB'><a
href="http://msdn2.microsoft.com/en-us/library/system.threading.apartmentstate.aspx"
target="_blank"
title="http://msdn2.microsoft.com/en-us/library/system.threading.apartmentstate.aspx"><span
style='font-size:11.0pt;font-family:Tahoma'>http://msdn2.microsoft.com/en-us/library/system.threading.apartmentstate.aspx</span></a></span></span><span
lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:EN-GB'>):<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:10.0pt;font-family:Arial;
color:navy;mso-ansi-language:EN-GB'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:10.0pt;font-family:Arial;
color:navy;mso-ansi-language:EN-GB'></span><span lang=EN-US style='font-size:
10.0pt;font-family:Verdana;mso-ansi-language:EN-US'>Because COM classes use
apartments, the common language runtime needs to create and initialize an
apartment when calling a COM object in a COM interop situation. A managed
thread can create and enter a single-threaded apartment (STA) that allows only
one thread, or a multithreaded apartment (MTA) that contains one or more threads..<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:8.5pt;font-family:Verdana;
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;
mso-ansi-language:EN-GB'>Since Internet Explorer is not Thread safe we need to
use STA.<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-family:Verdana;mso-ansi-language:
EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-GB
style='font-family:Tahoma;color:#99CC00;mso-ansi-language:EN-GB'>Differences in
ApartmentState between .Net 1.1 and .Net 2.0</span></b><b><span lang=EN-GB
style='font-size:10.0pt;font-family:Arial;color:navy;mso-ansi-language:EN-GB'><o:p></o:p></span></b></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;
mso-ansi-language:EN-GB'>Digging through MSDN I found out that Microsoft not
only has changed the calling convention for setting or getting the ApartmentState,
it also changed the default ApartmentState for a Thread in .Net 2.0. (see <a
href="http://msdn.microsoft.com/netframework/programming/breakingchanges/runtime/clr.aspx"
target="_blank">http://msdn.microsoft.com/netframework/programming/breakingchanges/runtime/clr.aspx</a>
and search for STAThreadAttribute).<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;
mso-ansi-language:EN-GB'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;
mso-ansi-language:EN-GB'>In .Net 1.1 the default ApartmentState of a Thread is
Unknown. A running Thread with this ApartmentState can be set to STA or MTA,
but only once. Trying to set the Apartment state of a running Thread from MTA
to STA (or vice versa) doesnt have any effect, it remains MTA (or STA).<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;
mso-ansi-language:EN-GB'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;
mso-ansi-language:EN-GB'>In .Net 2.0 the default ApartmentState of a Thread is
MTA. Trying to reset the ApartmentState of a running Thread from MTA to STA (or
vice versa) doesnt have any effect, it remains MTA. Setting the ApartmentState
to Unknown or STA instead of MTA, can ONLY be done BEFORE the Thread starts. <o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-GB style='font-family:Tahoma;mso-ansi-language:
EN-GB'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-GB
style='font-family:Tahoma;color:#99CC00;mso-ansi-language:EN-GB'>Implications<o:p></o:p></span></b></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;
mso-ansi-language:EN-GB'>Using WatiN works fine in a console or GUI application
when you apply the [STAThread] attribute to the main methode (the sole entry
point of the application). This way the main Thread runs as STA and all goes
well. When using a runner like MBUnit, NUnit or any other runner that starts
the main Thread, your code/tests depend upon the ApartmentState the runner
started with. <o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;
mso-ansi-language:EN-GB'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-GB
style='font-family:Tahoma;color:#99CC00;mso-ansi-language:EN-GB'>Behaviour of
WatiN when Thread is not an STA Thread.<o:p></o:p></span></b></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;
mso-ansi-language:EN-GB'>WatiN 0.7.0:<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;
mso-ansi-language:EN-GB'>You will get an Invalid cast exception being thrown
when you create an instance of the WatiN.Core.IE class.<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;
mso-ansi-language:EN-GB'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;
mso-ansi-language:EN-GB'>WatiN 0.8.0 (and later): <o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;
mso-ansi-language:EN-GB'>Will throw a ThreadStateException when you create an
instance of the WatiN.Core.IE class, to help you remind to set the
ApartmentState to STA.<i style='mso-bidi-font-style:normal'><o:p></o:p></i></span></p>

<p class=MsoNormal><span lang=EN-GB style='font-family:Tahoma;mso-ansi-language:
EN-GB'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><a name=mbunit><b style='mso-bidi-font-weight:normal'><span
lang=EN-GB style='font-family:Tahoma;color:#99CC00;mso-ansi-language:EN-GB'>Using
WatiN and MBUnit<o:p></o:p></span></b></a></p>

<span style='mso-bookmark:mbunit'></span>

<p class=MsoNormal><span lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;
mso-ansi-language:EN-GB'>Setting the ApartmentState for a <a
href="http://www.mertner.com/confluence/display/MbUnit/MbUnit+Home">MBUnit</a>
TestFixture is quit simple. Following is a basic example copied from </span><span
class=MsoHyperlink><span style='font-size:11.0pt;font-family:Tahoma'><a
href="http://www.mertner.com/confluence/display/MbUnit/FixtureThreadApartmentState"
target="_blank"
title="http://www.mertner.com/confluence/display/MbUnit/FixtureThreadApartmentState"><span
lang=EN-GB style='mso-ansi-language:EN-GB'>http://www.mertner.com/confluence/display/MbUnit/FixtureThreadApartmentState</span></a></span></span><span
lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:EN-GB'>.
<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;
mso-ansi-language:EN-GB'><o:p>&nbsp;</o:p></span></p>

<pre style='background:#D9D9D9'><span lang=EN-GB style='color:black;mso-ansi-language:
EN-GB'>[TestFixture(ApartmentState = ApartmentState.STA)]<o:p></o:p></span></pre><pre
style='background:#D9D9D9'><span class=code-keyword2><span lang=EN-GB
style='mso-ansi-language:EN-GB'>public</span></span><span lang=EN-GB
style='color:black;mso-ansi-language:EN-GB'> class WatiNTestFixture<o:p></o:p></span></pre><pre
style='background:#D9D9D9'><span lang=EN-GB style='color:black;mso-ansi-language:
EN-GB'>{<o:p></o:p></span></pre><pre style='background:#D9D9D9'><span
lang=EN-GB style='color:black;mso-ansi-language:EN-GB'>&nbsp;&nbsp; [Test]<o:p></o:p></span></pre><pre
style='background:#D9D9D9'><span lang=EN-GB style='color:black;mso-ansi-language:
EN-GB'>&nbsp;&nbsp; </span><span class=code-keyword2><span lang=EN-GB
style='mso-ansi-language:EN-GB'>public</span></span><span lang=EN-GB
style='color:black;mso-ansi-language:EN-GB'> void WatiNTest()<o:p></o:p></span></pre><pre
style='background:#D9D9D9'><span lang=EN-GB style='color:black;mso-ansi-language:
EN-GB'>&nbsp;&nbsp; {<o:p></o:p></span></pre><pre style='background:#D9D9D9'><span
lang=EN-GB style='color:black;mso-ansi-language:EN-GB'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ....<o:p></o:p></span></pre><pre
style='background:#D9D9D9'><span lang=EN-GB style='color:black;mso-ansi-language:
EN-GB'>&nbsp;&nbsp; }<o:p></o:p></span></pre>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-GB style='font-family:Tahoma;mso-ansi-language:EN-GB'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><a
name=nunit><b style='mso-bidi-font-weight:normal'><span lang=EN-GB
style='font-family:Tahoma;color:#99CC00;mso-ansi-language:EN-GB'>Using WatiN
and NUnit<o:p></o:p></span></b></a></p>

<span style='mso-bookmark:nunit'></span>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:EN-GB'>First
you need to create a config file for your test assembly. The naming of this
file depends on how you use NUnit (more info <a
href="http://nunit.com/blogs/?p=9" target="_blank">here</a>):<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:EN-GB'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-indent:-18.0pt;mso-list:l0 level1 lfo5;
tab-stops:list 18.0pt'><![if !supportLists]><span lang=EN-GB style='font-size:
11.0pt;font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:
Symbol;mso-ansi-language:EN-GB'><span style='mso-list:Ignore'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-GB style='font-size:11.0pt;
font-family:Tahoma;mso-ansi-language:EN-GB'>If you load a test assembly
directly, such as mytests.dll, the config file must be named mytests.dll.config
located in the same directory mytests.dll is in.<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-indent:-18.0pt;mso-list:l0 level1 lfo5;
tab-stops:list 18.0pt'><![if !supportLists]><span lang=EN-GB style='font-size:
11.0pt;font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:
Symbol;mso-ansi-language:EN-GB'><span style='mso-list:Ignore'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-GB style='font-size:11.0pt;
font-family:Tahoma;mso-ansi-language:EN-GB'>If you load an NUnit project, such
as mytests.nunit, the config file must be named mytests.config. <o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-indent:-18.0pt;mso-list:l0 level1 lfo5;
tab-stops:list 18.0pt'><![if !supportLists]><span lang=EN-GB style='font-size:
11.0pt;font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:
Symbol;mso-ansi-language:EN-GB'><span style='mso-list:Ignore'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-GB style='font-size:11.0pt;
font-family:Tahoma;mso-ansi-language:EN-GB'>If you use NUnits Visual Studio support
to load a Visual Studio project or solution, such as mytests.csproj or
mytests.sln, the config file must be named mytests.config.<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:EN-GB'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:EN-GB'>Next,
paste the following XML into the config. The trick is in the </span><span
lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";color:darkmagenta;
mso-ansi-language:EN-GB'>&lt;add </span><span lang=EN-GB style='font-size:10.0pt;
font-family:"Courier New";color:red;mso-ansi-language:EN-GB'>key</span><span
lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";color:blue;
mso-ansi-language:EN-GB'>=&quot;ApartmentState&quot; </span><span lang=EN-GB
style='font-size:10.0pt;font-family:"Courier New";color:red;mso-ansi-language:
EN-GB'>value</span><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:blue;mso-ansi-language:EN-GB'>=&quot;STA&quot; </span><span lang=EN-GB
style='font-size:10.0pt;font-family:"Courier New";color:darkmagenta;mso-ansi-language:
EN-GB'>/&gt; </span><span lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;
mso-ansi-language:EN-GB'>part. nunit-gui and nunit-console will now run all
your tests in the assembly on a single threaded apartment Thread.<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-GB style='font-size:10.0pt;font-family:Arial;color:navy;mso-ansi-language:
EN-GB'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:#D9D9D9'><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:blue;mso-ansi-language:EN-GB'>&lt;?xml version=&quot;1.0&quot;
encoding=&quot;utf-8&quot; ?&gt;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:#D9D9D9'><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:darkmagenta;mso-ansi-language:EN-GB'>&lt;configuration&gt;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:#D9D9D9'><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:darkmagenta;mso-ansi-language:EN-GB'>&nbsp; &lt;configSections&gt;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:#D9D9D9'><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:darkmagenta;mso-ansi-language:EN-GB'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;sectionGroup </span><span lang=EN-GB style='font-size:10.0pt;font-family:
"Courier New";color:red;mso-ansi-language:EN-GB'>name</span><span lang=EN-GB
style='font-size:10.0pt;font-family:"Courier New";color:blue;mso-ansi-language:
EN-GB'>=&quot;NUnit&quot;</span><span lang=EN-GB style='font-size:10.0pt;
font-family:"Courier New";color:darkmagenta;mso-ansi-language:EN-GB'>&gt;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:#D9D9D9'><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:darkmagenta;mso-ansi-language:EN-GB'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;section </span><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:red;mso-ansi-language:EN-GB'>name</span><span lang=EN-GB
style='font-size:10.0pt;font-family:"Courier New";color:blue;mso-ansi-language:
EN-GB'>=&quot;TestRunner&quot; </span><span lang=EN-GB style='font-size:10.0pt;
font-family:"Courier New";color:red;mso-ansi-language:EN-GB'>type</span><span
lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";color:blue;
mso-ansi-language:EN-GB'>=&quot;System.Configuration.NameValueSectionHandler&quot;</span><span
lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";color:darkmagenta;
mso-ansi-language:EN-GB'>/&gt;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:#D9D9D9'><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:darkmagenta;mso-ansi-language:EN-GB'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;/sectionGroup&gt;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:#D9D9D9'><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:darkmagenta;mso-ansi-language:EN-GB'>&nbsp; &lt;/configSections&gt;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:#D9D9D9'><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:darkmagenta;mso-ansi-language:EN-GB'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:#D9D9D9'><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:darkmagenta;mso-ansi-language:EN-GB'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;NUnit&gt;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:#D9D9D9'><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:darkmagenta;mso-ansi-language:EN-GB'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;TestRunner&gt;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:#D9D9D9'><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:darkmagenta;mso-ansi-language:EN-GB'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:darkslategray;mso-ansi-language:EN-GB'>&lt;!-- Valid values are STA,MTA.
Others ignored. --&gt;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:#D9D9D9'><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:darkslategray;mso-ansi-language:EN-GB'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:darkmagenta;mso-ansi-language:EN-GB'>&lt;add </span><span lang=EN-GB
style='font-size:10.0pt;font-family:"Courier New";color:red;mso-ansi-language:
EN-GB'>key</span><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:blue;mso-ansi-language:EN-GB'>=&quot;ApartmentState&quot; </span><span
lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";color:red;
mso-ansi-language:EN-GB'>value</span><span lang=EN-GB style='font-size:10.0pt;
font-family:"Courier New";color:blue;mso-ansi-language:EN-GB'>=&quot;STA&quot; </span><span
lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";color:darkmagenta;
mso-ansi-language:EN-GB'>/&gt;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:#D9D9D9'><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:darkmagenta;mso-ansi-language:EN-GB'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;/TestRunner&gt;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:#D9D9D9'><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:darkmagenta;mso-ansi-language:EN-GB'>&nbsp; &lt;/NUnit&gt;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:#D9D9D9'><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:darkmagenta;mso-ansi-language:EN-GB'>&lt;/configuration&gt;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-GB style='font-size:10.0pt;font-family:Arial;color:navy;mso-ansi-language:
EN-GB'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:EN-GB'>Following
is some background information about the differences between the behaviour of <a
href="http://www.nunit.org/" target="_blank">NUnit</a><span
style='mso-spacerun:yes'>  </span>for .Net 1.1. and .Net 2.0 (keep the
explanation about<span style='mso-spacerun:yes'>  </span>Differences in
ApartmentState between .Net 1.1 and .Net 2.0 in mind). <o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:EN-GB'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:EN-GB'>To
run the unit tests, NUnit creates Threads with the default ApartmentState. So
if you use WatiN in a NUnit .Net 1.1 environment, a Thread with the
ApartmentState Unknown is created. This makes it possible to set the
ApartmentState (only ones) to STA. You could do this, for instance, in your
TestFixtureSetup function by adding the following line of code:<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:EN-GB'><o:p>&nbsp;</o:p></span></p>

<p class=cl style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:#D9D9D9'><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:black;mso-ansi-language:EN-GB'>System.Threading.Thread.CurrentThread.ApartmentState
= System.Threading.ApartmentState.STA;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:EN-GB'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:EN-GB'>But
Using WatiN in a NUnit .net 2.0 environment, this code doesnt work, even if
you make the syntax .Net 2.0 compliant:<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:EN-GB'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:#D9D9D9'><span lang=EN-GB style='font-size:10.0pt;font-family:"Courier New";
color:black;mso-ansi-language:EN-GB'>System.Threading</span><span lang=EN-GB
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-GB'>.Thread.Currentthread.SetApartmentState(<span
style='color:black'>System.Threading</span>.ApartmentStat.STA);<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:EN-GB'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:EN-GB'>This
is caused by the fact that NUnit now creates a Thread with the ApartmentState
set to MTA (the .Net 2.0 default value).<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:EN-GB'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:EN-GB'>So
my advise: if you develop in a .Net 1.1 environment, use the config file to
force the right ApartmentState. This will give you a hassle free migration to
the .Net 2.0 framework (regarding the use of WatiN).<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-GB style='font-size:10.0pt;font-family:Arial;color:navy;mso-ansi-language:
EN-GB'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><a
name=vs2005><b style='mso-bidi-font-weight:normal'><span lang=EN-GB
style='font-family:Tahoma;color:#99CC00;mso-ansi-language:EN-GB'>Using WatiN
and Visual Studio 2005 test runner.<o:p></o:p></span></b></a></p>

<span style='mso-bookmark:vs2005'></span>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:EN-GB'>No
special tricks needed. The Visual Studio 2005 Team System test runner runs all
its tests in STA mode by default.<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-GB style='font-family:Tahoma;mso-ansi-language:EN-GB'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><a
name=testdriven><b style='mso-bidi-font-weight:normal'><span lang=EN-GB
style='font-family:Tahoma;color:#99CC00;mso-ansi-language:EN-GB'>Using WatiN and
TestDriven.Net in VS 2003 and VS 2005.<o:p></o:p></span></b></a></p>

<span style='mso-bookmark:testdriven'></span>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:EN-GB'>No
special tricks needed. <a href="http://www.testdriven.net/" target="_blank">TestDriven.Net</a>
runs all its tests in STA mode by default.<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:EN-GB'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><a
name=sharpdevelop><b style='mso-bidi-font-weight:normal'><span lang=EN-GB
style='font-family:Tahoma;color:#99CC00;mso-ansi-language:EN-GB'>Using WatiN
and SharpDevelops NUnit test runner.<o:p></o:p></span></b></a></p>

<span style='mso-bookmark:sharpdevelop'></span>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-GB style='font-size:11.0pt;font-family:Tahoma;mso-ansi-language:EN-GB'>Currently
the NUnit test runner in <a
href="http://www.sharpdevelop.com/OpenSource/SD/Default.aspx" target="_blank">SharpDevelop</a>
doesnt run tests in STA mode and ignores the settings in any config file (as
explained in Using WatiN with NUnit). You can however develop your tests with
SharpDevelop and then run your tests out side the development environment with
NUnit or any other test runner.<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-GB style='mso-ansi-language:EN-GB'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-GB style='mso-ansi-language:EN-GB'><o:p>&nbsp;</o:p></span></p>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0 width="100%"
 style='width:100.0%;border-collapse:collapse;mso-yfti-tbllook:480;mso-padding-alt:
 0cm 5.4pt 0cm 5.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;mso-yfti-lastrow:yes'>
  <td width="50%" valign=top style='width:50.0%;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:Tahoma'><a
  href="http://sourceforge.net"><span style='text-decoration:none;text-underline:
  none'><img border=0 width=125 height=37 id="_x0000_i1025"
  src="http://sflogo.sourceforge.net/sflogo.php?group_id=167632&amp;type=2"
  alt="SourceForge.net Logo"></span></a><span style='mso-tab-count:1'>   </span></span><span
  style='font-size:10.0pt;font-family:Tahoma'><o:p></o:p></span></p>
  </td>
  <td width="50%" valign=bottom style='width:50.0%;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:Tahoma'>Last update on </span><!--[if supportFields]><span
  style='font-size:10.0pt;font-family:Tahoma'><span style='mso-element:field-begin'></span></span><span
  lang=EN-GB style='font-size:10.0pt;font-family:Tahoma;mso-ansi-language:EN-GB'><span
  style='mso-spacerun:yes'> </span>DATE \@ &quot;dd MMMM yyyy&quot; </span><span
  style='font-size:10.0pt;font-family:Tahoma'><span style='mso-element:field-separator'></span></span><![endif]--><span
  lang=EN-GB style='font-size:10.0pt;font-family:Tahoma;mso-ansi-language:EN-GB;
  mso-no-proof:yes'>27 September 2006</span><!--[if supportFields]><span
  style='font-size:10.0pt;font-family:Tahoma'><span style='mso-element:field-end'></span></span><![endif]--><span
  style='font-size:10.0pt;font-family:Tahoma'><o:p></o:p></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='font-size:10.0pt;font-family:Tahoma'><span
style='mso-spacerun:yes'> </span></span><!--[if supportFields]><span
style='font-size:10.0pt;font-family:Tahoma'><span style='mso-element:field-begin'></span><span
style='mso-spacerun:yes'> </span>LASTSAVEDBY<span style='mso-spacerun:yes'>  
</span>\* MERGEFORMAT </span><![endif]--><!--[if supportFields]><span
style='font-size:10.0pt;font-family:Tahoma'><span style='mso-element:field-end'></span></span><![endif]--><span
style='font-size:10.0pt;font-family:Tahoma'><o:p></o:p></span></p>

</div>

</body>

</html>
